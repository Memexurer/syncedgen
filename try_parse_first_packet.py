xd1 = bytes.fromhex("210001b46deee6efe2bb63c6180bfd411f00ff630f41726b506c61796572456e74697479ffffffffffffffff000001410a0d0a086d73675f747970651201310a120a066d73675f6964120839313030383935310a1b0a09656e746974795f6964120e35323438333433363537353834320f4445534b544f502d514639434a42310002706600784c6576656c496e66696e6974655f4c6576656c496e66696e6974652d30303030303030302d77696e646f77732d30303030303030302d4c6576656c496e66696e6974652d61656335373562346231346338373031366463653337363466656132333966622d31393236393734313836343639343239333535000570666b6579002033656432343731643963643530346135333663316639333335363166396161340004a7a42b251414141402656e003e3739333732646435323365626532663133323633373332613331613465646666343032316264326631346166646338303663343032626639366333336266000000000a0000000100000067960300020000001701000003000000670000000400000066000000050000006a00000006060614062806140614322a010303039a69f6adcbf378e937e381189559ee5f")
xd2 = bytes.fromhex("210001b4d424125bc5d1e02d180bfd411f00ca370f41726b506c61796572456e74697479ffffffffffffffff0000013d0a0d0a086d73675f747970651201310a120a066d73675f6964120839313030383935310a1b0a09656e746974795f6964120e35323438343531303034333932390f4445534b544f502d514639434a4231000570666b6579002064316132323030343333363439633031303638353939613265313564633535370002706600764c6576656c496e66696e6974655f4c6576656c496e66696e6974652d57696e646f77732d77696e646f77732d57696e646f77732d4c6576656c496e66696e6974652d61656335373562346231346338373031366463653337363466656132333966622d313932363937343138363436393432363932330004a59f7e7b1414141402656e003e373933373264643532336562653266313332363337333261333161346564666634303231626432663134616664633830366334303262663936633333626600000a0000000100000067960300020000001301000003000000650000000400000064000000050000006800000006060614062806140614322a010707070707070763765bbe4364585f1a7b4c45c15083bc")
# dict with: {'msg_type': '1', 'msg_id': '91008951', 'entity_id': '52483436575842'}
def unpack_dict(xd):
    dick = {}

    for entry in xd.split(b"\n"):
        split = entry.split(b"\x12")
        if len(split) != 2:
            continue
        key, value = split
        if len(key) == 0:
            continue

        value = value[1:value[0]+1]
        last_index = xd.index(value) + len(value)
        dick[key[1:key[0]+1].decode()] = value.decode()
        
    return dick, last_index

def unpack_different_dict(xd, limit):
    dick = {}

    key = None
    value = None

    for entry in xd.split(b"\00"):
        if len(entry) == 0:
            continue

        if len(dick) == limit:
            break

        if not key:
            key = entry[1:entry[0] + 1]
            continue
        
        if not value:
            value = entry[1:entry[0] + 1]
            
            last_index = xd.index(value) + len(value) +1 # + 1 bo dicty sie koncza na \00
            dick[key.decode()] = value.decode()
            key = None
            value = None


    return dick, last_index


def decode_packet(xd):
    print(xd[:20].hex())
    xd = xd[20:] # skip known packet header

    print("Idk:")

    print(xd[:25].hex())
    xd = xd[25:]

    dick, last_index = unpack_dict(xd)
    print(dick)
    xd = xd[last_index:]

    pc_name = xd[1:xd[0]]
    print(pc_name.decode())
    xd = xd[xd[0] + 1:]

    dick, last_index = unpack_different_dict(xd, 2)
    print(dick)
    xd = xd[last_index:]

    idk = xd[1:xd[0]]
    print(idk.hex())
    xd = xd[xd[0] + 1:]

    xd = xd[4:] # skip \x14\x14\x14\x14


    dick, last_index = unpack_different_dict(xd, 1)
    print(dick)
    xd = xd[last_index:]

    print("Idk:")
    print(xd.hex())
print("---------")

decode_packet(bytes.fromhex('12 00 00 40 00 00 00 01 10 03 F5 58 A4 4A 4B F2 0F 41 72 6B 50 6C 61 79 65 72 45 6E 74 69 74 79 FF FF FF FF FF FF FF FF 00 00 00 A9 0A 1B 0A 09 65 6E 74 69 74 79 5F 69 64 12 0E 35 34 30 37 39 30 31 35 37 39 39 31 37 39 0A 12 0A 06 6D 73 67 5F 69 64 12 08 39 31 30 30 38 39 35 31 0A 0D 0A 08 6D 73 67 5F 74 79 70 65 12 01 31 0F 44 45 53 4B 54 4F 50 2D 51 46 39 43 4A 42 31 00 05 70 66 6B 65 79 00 00 00 02 70 66 00 00 00 04 0F 09 08 05 14 14 14 14 02 65 6E 00 3E 37 39 33 37 32 64 64 35 32 33 65 62 65 32 66 31 33 32 36 33 37 33 32 61 33 31 61 34 65 64 66 66 34 30 32 31 62 64 32 66 31 34 61 66 64 63 38 30 36 63 34 30 32 62 66 39 36 63 33 33 62 66 00 00 00 00 0A 00 00 00 01 00 00 00 8F A1 03 00 02 00 00 00 7F 00 00 00 03 00 00 00 67 00 00 00 04 00 00 00 66 00 00 00 05 00 00 00 6A 00 00 00 06 06 06 14 06 28 06 14 06 14 32 2A 01'))

print("---------")

# decode_packet(bytes.fromhex("5b38d618f18bcf31180bfd50ac40e0ff0f41726b506c61796572456e74697479ffffffffffffffff0000013d0a1b0a09656e746974795f6964120e35343038333330383933393238370a0d0a086d73675f747970651201310a120a066d73675f6964120839313030383935310f4445534b544f502d514639434a42310002706600764c6576656c496e66696e6974655f4c6576656c496e66696e6974652d57696e646f77732d77696e646f77732d57696e646f77732d4c6576656c496e66696e6974652d61656335373562346231346338373031366463653337363466656132333966622d31393236393734313836343639343331343138000570666b6579002031323038346465646566303537613637383138333736386561643566623664380004a5a22b251414141402656e003e373933373264643532336562653266313332363337333261333161346564666634303231626432663134616664633830366334303262663936633333626600000a000000010000008fa10300020000001301000003000000650000000400000064000000050000006800000006060614062806140614322a01070707070707071ff1c0c11b810cc5f97f9fb59336ead5"))
